syntax = "proto3";

package robot_vision;

message CameraInTagCoords {
  int32 tag_id = 1;
  repeated double mat = 2; // 4x4 matrix, [j*cols+i]
}

message CameraCoefficients {
  repeated double camera_matrix = 1; // 3x3
  repeated double distortion_coefficients = 2; // 1-D, variable size
}

message SetCameraCoefficients {
  int32 camera_id = 1;
  CameraCoefficients camera_coefficients = 2;
}

message CameraPosition {
  int32 camera_id = 1;
  repeated CameraInTagCoords camera_in_tag_coords = 2; // tag_id can be non-unique
}

message Telemetry {
  // to do...
}

message ReportCameraPositions {
  repeated CameraPosition camera_position = 1;
  repeated Telemetry telemetry = 2;
}

message ClientRequest {
  oneof msg {
    ReportCameraPositions report_camera_positions = 1;
    // future client-to-server messages
  }
}

message ServerRequest {
  oneof msg {
    SetCameraCoefficients set_camera_coefficients = 1;
    // future server-to-client messages
  }
}

message GetRobotPositionRequest {

}

message GetRobotPositionResponse {

}

service VisionSystem {
  // Endpoint for camera co-processors to connect to the central unit (opened by Camera unit). 
  rpc OpenControlStream(stream ClientRequest) returns (stream ServerRequest);
  // Gets robot position in World coordinates (called by PoboRIO).
  rpc GetRobotPosition(GetRobotPositionRequest) returns (GetRobotPositionResponse);
}